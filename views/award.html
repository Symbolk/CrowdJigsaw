<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title> CrowdJigaw | Puzzle</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="/stylesheets/font-awesome.min.css">

    <!-- Ionicons -->
    <link rel="stylesheet" href="/stylesheets/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="/stylesheets/AdminLTE.min.css">
    <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
          page. However, you can choose any other skin. Make sure you
          apply the skin class to the body tag so the changes take effect. -->
    <link rel="stylesheet" href="/stylesheets/skin-blue-light.min.css">
    <link rel='stylesheet' href='/stylesheets/style.css' />

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!--<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.teal-blue.min.css" />-->
    <link rel="stylesheet" href="/stylesheets/material.teal-blue.min.css" />
    <link rel="stylesheet" href="/stylesheets/bootstrap.min.css" />
    <link rel="stylesheet" href="/stylesheets/display.css" />
    <link rel="stylesheet" href="/stylesheets/bootstrap-table.min.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/dialog-polyfill.css" />
    <link rel="stylesheet" href="/stylesheets/buttons.css">
    <link rel="stylesheet" href="/stylesheets/animate.min.css">
    <link rel="stylesheet" href="/stylesheets/amaran.min.css">
    <link rel="stylesheet" href="/stylesheets/bootstrap-slider.min.css">

    <!-- iCheck -->
    <link rel="stylesheet" href="/stylesheets/icheck-bootstrap.min.css">

    <script type="text/javascript">
        var scoreboard = '<%-scoreboard-%>';
        var username = '<%-username-%>';
        var round_id = '<%-round_id-%>';
        var players_num = '<%-players_num-%>';
        players_num = parseInt(players_num);
        scoreboard = JSON.parse(scoreboard);

        console.log(scoreboard);

        var defeat_num = 0;
        var my_score = 0;
        var player1 = '';
        var player2 = '';
        var player3 = '';
        for (var i = 0; i < scoreboard.length; i += 2) {
            if (username == scoreboard[i]) {
                console.log(i, scoreboard.length);
                defeat_num = (1 - (i + 2) / scoreboard.length) * 100;
                console.log(defeat_num);
                my_score = scoreboard[i+1]
            }
            if (i == 0) {
                player1 = scoreboard[i] + ':' + scoreboard[i+1];
            }
            if (i == 2) {
                player2 = scoreboard[i] + ':' + scoreboard[i+1];
            }
            if (i == 4) {
                player3 = scoreboard[i] + ':' + scoreboard[i+1];
            }
        }

        var firework = function () {
            this.size = 40;
            this.speed = 0.1;
            this.rise();
        }
        firework.prototype = {
            color: function () {
                var c = ['0', '3', '6', '9', 'c', 'f'];
                var t = [c[Math.floor(Math.random() * 100) % 6], '0', 'f'];
                t.sort(function () {
                    return Math.random() > 0.5 ? -1 : 1;
                });
                return '#' + t.join('');
            },
            aheight: function () {
                var h = document.documentElement.clientHeight;
                return Math.abs(Math.floor(Math.random() * h - 200)) + 201;
            },
            firecracker: function () {
                var b = document.createElement('div');
                var w = document.body.clientWidth;
                b.style.color = this.color();
                b.style.position = 'absolute';
                b.style.bottom = 0;
                b.style.left = Math.floor(Math.random() * w) + 1 + 'px';
                document.getElementById('fire').appendChild(b);
                return b;
            },
            rise: function () {
                var o = this.firecracker();
                var n = this.aheight();
                var speed = this.speed;
                var e = this.expl;
                var s = this.size;
                var k = n;
                var m = function () {
                    o.style.bottom = parseFloat(o.style.bottom) + k * speed + 'px';
                    k -= k * speed;
                    if (k < 2) {
                        clearInterval(clear);
                        e(o, n, s, speed);
                    }
                }
                o.innerHTML = '*';
                if (parseInt(o.style.bottom) < n) {
                    var clear = setInterval(m, 20);
                }
            },
            expl: function (o, n, s, speed) {
                var R = n / 3;
                var Ri = n / 6;
                var r = 0;
                var ri = 0;
                for (var i = 0; i < s; i++) {
                    var span = document.createElement('span');
                    var p = document.createElement('p');
                    span.style.position = 'absolute';
                    span.style.left = 0;
                    span.style.top = 0;
                    span.innerHTML = '*';
                    p.style.position = 'absolute';
                    p.style.left = 0;
                    p.style.top = 0;
                    p.innerHTML = '+';
                    o.appendChild(span);
                    o.appendChild(p);
                }

                function spr() {
                    r += R * speed;
                    ri += Ri * speed / 2;
                    sp = o.getElementsByTagName('span');
                    p = o.getElementsByTagName('p');
                    for (var i = 0; i < sp.length; i++) {
                        sp[i].style.left = r * Math.cos(360 / s * i) + 'px';
                        sp[i].style.top = r * Math.sin(360 / s * i) + 'px';
                        p[i].style.left = ri * Math.cos(360 / s * i) + 'px';
                        p[i].style.top = ri * Math.sin(360 / s * i) + 'px';
                    }
                    R -= R * speed;
                    if (R < 2) {
                        clearInterval(clearI);
                        o.parentNode.removeChild(o);
                    }
                }
                var clearI = setInterval(spr, 20);
            }
        }
        window.onload = function () {
            function happyNewYear() {
                new firework();
            }
            setInterval(happyNewYear, 400);
        }
    </script>
</head>
<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to get the
desired effect
|---------------------------------------------------------|
| SKINS         | skin-blue                               |
|               | skin-black                              |
|               | skin-purple                             |
|               | skin-yellow                             |
|               | skin-red                                |
|               | skin-green                              |
|---------------------------------------------------------|
|LAYOUT OPTIONS | fixed                                   |
|               | layout-boxed                            |
|               | layout-top-nav                          |
|               | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|
-->

<body class="hold-transition skin-blue-light sidebar-mini" style="padding: 0;">
    <div class="wrapper">

        <!-- Main Header -->
        <header class="main-header">

            <!-- Logo -->
            <a href="/home" class="logo">
                <!-- mini logo for sidebar mini 50x50 pixels -->
                <span class="logo-mini">
                    <b>C</b>JP</span>
                <!-- logo for regular state and mobile devices -->
                <span class="logo-lg">
                    <b>Crowd</b>Jigsaw</span>
            </a>

            <!-- Header Navbar -->
            <nav class="navbar navbar-static-top" role="navigation">
                <!-- Sidebar toggle button-->
                <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
                    <span class="sr-only">Toggle navigation</span>
                </a>
                <!-- Navbar Right Menu -->
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <!-- User Account Menu -->
                        <li class="dropdown user user-menu">
                            <!-- Menu Toggle Button -->
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <!-- The user image in the navbar-->
                                <img src="" class="user-image headImg" alt="User Image">
                                <canvas id="headImg" style="display:none"></canvas>
                                <!-- hidden-xs hides the username on small devices so only the image appears. -->
                                <span class="hidden-xs">
                                    <%= username %>
                                </span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- The user image in the menu -->
                                <li class="user-header">
                                    <img src="" class="img-circle headImg" alt="User Image">
                                    <canvas id="headImg" style="display:none"></canvas>
                                    <p>
                                        <%= username %>
                                        <small>Member since 2018.</small>
                                    </p>
                                </li>
                                <!-- Menu Footer-->
                                <li class="user-footer">
                                    <!-- <div class="pull-left">
                              <a href="#" class="btn btn-default btn-flat">Profile</a>
                            </div> -->
                                    <div class="pull-right">
                                        <a href="/logout" class="btn btn-default btn-flat">Sign out</a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                        <!-- Control Sidebar Toggle Button -->
                        <li>
                            <a href="#" data-toggle="control-sidebar">
                                <i class="fa fa-gears"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <!-- Left side column. contains the logo and sidebar -->
        <aside class="main-sidebar">

            <!-- sidebar: style can be found in sidebar.less -->
            <section class="sidebar">

                <!-- Sidebar user panel (optional) -->
                <div class="user-panel">
                    <div class="pull-left image">
                        <img src="" class="img-circle head-sidebar" alt="User Image">
                        <canvas id="head-sidebar" style="display:none"></canvas>
                    </div>
                    <div class="pull-left info">
                        <p>
                            <%= username %>
                        </p>
                        <!-- Status -->
                        <a href="#">
                            <i class="fa fa-circle text-success"></i> Online</a>
                    </div>
                </div>

                <!-- search form (Optional) -->
                <!-- <form action="#" method="get" class="sidebar-form">
          <div class="input-group">
            <input type="text" name="q" class="form-control" placeholder="Search...">
            <span class="input-group-btn">
                <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i>
                </button>
              </span>
          </div>
        </form> -->
                <!-- /.search form -->

                <!-- Sidebar Menu -->
                <ul class="sidebar-menu" data-widget="tree">
                    <li class="header">Pages</li>
                    <!-- Optionally, you can add icons to the links -->
                    <li class="active">
                        <a href="/home">
                            <i class="fa fa-gamepad fa-lg"></i>
                            <span>Playground</span>
                        </a>
                    </li>
                    <li>
                        <a href="/records">
                            <i class="fa fa-calendar fa-lg"></i>
                            <span>Records</span>
                        </a>
                    </li>
                    <li>
                        <a href="/settings">
                            <i class="fa fa-gears fa-lg"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                    <li>
                        <a href="/rank">
                            <i class="fa fa-list-ol fa-lg"></i>
                            <span>Ranks</span>
                        </a>
                    </li>
                    <li>
                        <a href="/statistics">
                            <i class="fa fa-area-chart fa-lg"></i>
                            <span>Statistics</span>
                        </a>
                    </li>
                    <li>
                        <a href="/help">
                            <i class="fa fa-question-circle fa-lg"></i>
                            <span>Help</span>
                        </a>
                    </li>

                    <li class="treeview">
                        <a href="#">
                            <i class="fa fa-link fa-lg"></i>
                            <span>Links</span>
                            <span class="pull-right-container">
                                <i class="fa fa-angle-right pull-right"></i>
                            </span>
                        </a>
                        <ul class="treeview-menu">
                            <li>
                                <a href="https://github.com/Symbolk/CrowdJigsaw">Github</a>
                            </li>
                            <li>
                                <a href="http://symbolk.com">Blog</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="/logout">
                            <i class="fa fa-sign-out fa-lg"></i>
                            <span>Sign Out</span>
                        </a>
                    </li>
                </ul>
                <!-- /.sidebar-menu -->
            </section>
            <!-- /.sidebar -->
        </aside>
        <script src="/javascripts/jquery.min.js"></script>

        <script>
            $(function () {
            var uname = '<%= username %>';
            var name = uname.charAt(0);
            var fontSize = 60;
            var fontWeight = 'bold';

            var canvas = document.getElementById('headImg');
            var img1 = document.getElementById('headImg');
            canvas.width = 120;
            canvas.height = 120;
            var context = canvas.getContext('2d');
            context.fillStyle = '#FFFFFF';
            context.fillRect(0, 0, canvas.width, canvas.height);
            context.fillStyle = '#4682B4';
            context.font = fontWeight + ' ' + fontSize + 'px sans-serif';
            context.textAlign = 'center';
            context.textBaseline = "middle";
            context.fillText(name, fontSize, fontSize);
            $('.headImg').attr('src', canvas.toDataURL("image/png"));

            var canvas = document.getElementById('head-sidebar');
            var img1 = document.getElementById('head-sidebar');
            canvas.width = 120;
            canvas.height = 120;
            var context = canvas.getContext('2d');
            context.fillStyle = '#4682B4';
            context.fillRect(0, 0, canvas.width, canvas.height);
            context.fillStyle = '#FFFFFF';
            context.font = fontWeight + ' ' + fontSize + 'px sans-serif';
            context.textAlign = 'center';
            context.textBaseline = "middle";
            context.fillText(name, fontSize, fontSize);
            $('.head-sidebar').attr('src', canvas.toDataURL("image/png"));
        });
    </script>

        <div class="content-wrapper" id="fire">
            <div id="mypic" class="right2">
                <p id="player1"> </p>
                <p id="player2"> </p>
                <p id="player3"> </p>
            </div>
            <br />
            <div id="myhonor" class="left2">
                <img id="badge" src="/images/badge.png">
                <p id='defeat_message'> </p>
            <a href="/home" class="ok_button button button-3d button-primary button-rounded">OK</a>
            </div>

        </div>

    <script type="text/javascript">
        document.getElementById('player1').innerText = player1;
        document.getElementById('player2').innerText = player2;
        document.getElementById('player3').innerText = player3;
        var defeat_html = "You defeated " + defeat_num + "% of players. <br> Your score is " + my_score + ". ";
        document.getElementById('defeat_message').innerHTML = defeat_html;
    </script>


        <!-- Main Footer -->
        <footer class="main-footer">
            <!-- To the right -->
            <div class="pull-right hidden-xs">
                Collective Intelligence Software Engineering
            </div>
            <!-- Default to the left -->
            <strong>Copyright &copy; 2018
                <a href="#">******</a>.</strong> All rights reserved.
        </footer>

    </div>
    <!-- ./wrapper -->

    <!-- REQUIRED JS SCRIPTS -->

    <!-- jQuery 3 -->
    <script src="/javascripts/jquery.min.js"></script>
    <!-- Bootstrap 3.3.7 -->
    <script src="/javascripts/bootstrap.min.js"></script>
    <!-- AdminLTE App -->
    <script src="/javascripts/adminlte.min.js"></script>

    <!-- Optionally, you can add Slimscroll and FastClick plugins.
     Both of these plugins are recommended to enhance the
     user experience. -->
    <script type="text/javascript" src="/javascripts/socket.io.js"></script>
    <script src="/javascripts/dialog-polyfill.js"></script>
    <script src="/javascripts/jquery.amaran.min.js"></script>


    <!-- <script src="/javascripts/bootstrap-table.min.js" ></script> -->
    <!--<script src="https://code.getmdl.io/1.3.0/material.min.js"></script>-->
    <script src="/javascripts/material.min.js"></script>

</body>

</html>